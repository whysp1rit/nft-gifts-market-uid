{% extends "mini_app/base.html" %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å - NFT Gifts Market{% endblock %}

{% block content %}
<div class="card">
    <div style="text-align: center; margin-bottom: 20px;">
        <div style="width: 80px; height: 80px; background: var(--tg-theme-link-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; font-size: 32px; color: white;">
            üë§
        </div>
        <h2 id="userName" style="margin-bottom: 4px;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h2>
        <p id="userInfo" style="color: var(--tg-theme-hint-color); font-size: 14px;">@username</p>
    </div>
</div>

<div class="card">
    <h3 style="margin-bottom: 16px;">üí∞ –ë–∞–ª–∞–Ω—Å</h3>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
        <div style="text-align: center; padding: 16px; background: var(--tg-theme-bg-color); border-radius: 8px; border: 1px solid var(--tg-theme-hint-color);">
            <div style="font-size: 20px; font-weight: bold; color: #ffc107;">‚≠ê 0</div>
            <div style="font-size: 12px; color: var(--tg-theme-hint-color);">–ó–≤–µ–∑–¥—ã</div>
        </div>
        <div style="text-align: center; padding: 16px; background: var(--tg-theme-bg-color); border-radius: 8px; border: 1px solid var(--tg-theme-hint-color);">
            <div style="font-size: 20px; font-weight: bold; color: #28a745;">‚ÇΩ 0</div>
            <div style="font-size: 12px; color: var(--tg-theme-hint-color);">–†—É–±–ª–∏</div>
        </div>
    </div>
    
    <div class="alert alert-info">
        <strong>üí° –ö–∞–∫ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å:</strong><br>
        –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞. –°—Ä–µ–¥—Å—Ç–≤–∞ –ø–æ—Å—Ç—É–ø–∞—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–¥–µ–ª–æ–∫.
    </div>
</div>

<div class="card">
    <h3 style="margin-bottom: 16px;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
        <div style="text-align: center; padding: 12px; background: var(--tg-theme-bg-color); border-radius: 8px; border: 1px solid var(--tg-theme-hint-color);">
            <div id="totalDeals" style="font-size: 18px; font-weight: bold; color: var(--tg-theme-link-color);">0</div>
            <div style="font-size: 11px; color: var(--tg-theme-hint-color);">–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫</div>
        </div>
        <div style="text-align: center; padding: 12px; background: var(--tg-theme-bg-color); border-radius: 8px; border: 1px solid var(--tg-theme-hint-color);">
            <div id="successfulDeals" style="font-size: 18px; font-weight: bold; color: #28a745;">0</div>
            <div style="font-size: 11px; color: var(--tg-theme-hint-color);">–£—Å–ø–µ—à–Ω—ã—Ö</div>
        </div>
        <div style="text-align: center; padding: 12px; background: var(--tg-theme-bg-color); border-radius: 8px; border: 1px solid var(--tg-theme-hint-color);">
            <div id="rating" style="font-size: 18px; font-weight: bold; color: #ffc107;">‚≠ê 5.0</div>
            <div style="font-size: 11px; color: var(--tg-theme-hint-color);">–†–µ–π—Ç–∏–Ω–≥</div>
        </div>
    </div>
</div>

<div class="card">
    <h3 style="margin-bottom: 16px;">üéØ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
    
    <div style="margin: 12px 0;">
        <div style="display: flex; align-items: center; margin: 8px 0; padding: 8px; background: var(--tg-theme-bg-color); border-radius: 8px; border: 1px solid var(--tg-theme-hint-color);">
            <span style="font-size: 24px; margin-right: 12px;">üéâ</span>
            <div>
                <div style="font-weight: 500;">–ü–µ—Ä–≤–∞—è —Å–¥–µ–ª–∫–∞</div>
                <div style="font-size: 12px; color: var(--tg-theme-hint-color);">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é —Å–¥–µ–ª–∫—É</div>
            </div>
        </div>
        
        <div style="display: flex; align-items: center; margin: 8px 0; padding: 8px; background: var(--tg-theme-bg-color); border-radius: 8px; border: 1px solid var(--tg-theme-hint-color); opacity: 0.5;">
            <span style="font-size: 24px; margin-right: 12px;">üèÜ</span>
            <div>
                <div style="font-weight: 500;">–û–ø—ã—Ç–Ω—ã–π —Ç—Ä–µ–π–¥–µ—Ä</div>
                <div style="font-size: 12px; color: var(--tg-theme-hint-color);">–ó–∞–≤–µ—Ä—à–∏—Ç–µ 10 —Å–¥–µ–ª–æ–∫</div>
            </div>
        </div>
        
        <div style="display: flex; align-items: center; margin: 8px 0; padding: 8px; background: var(--tg-theme-bg-color); border-radius: 8px; border: 1px solid var(--tg-theme-hint-color); opacity: 0.5;">
            <span style="font-size: 24px; margin-right: 12px;">üíé</span>
            <div>
                <div style="font-weight: 500;">VIP —Ç—Ä–µ–π–¥–µ—Ä</div>
                <div style="font-size: 12px; color: var(--tg-theme-hint-color);">–ó–∞–≤–µ—Ä—à–∏—Ç–µ 100 —Å–¥–µ–ª–æ–∫</div>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <h3 style="margin-bottom: 16px;">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
    
    <button class="btn btn-secondary" onclick="showNotificationSettings()">
        üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    </button>
    
    <button class="btn btn-secondary" onclick="showSupport()">
        üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞
    </button>
    
    <button class="btn btn-secondary" onclick="showAbout()">
        ‚ÑπÔ∏è –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
    </button>
</div>

<div class="card" style="text-align: center;">
    <p style="color: var(--tg-theme-hint-color); font-size: 12px; margin-bottom: 8px;">
        NFT Gifts Market v1.0
    </p>
    <p style="color: var(--tg-theme-hint-color); font-size: 12px;">
        –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è NFT –ø–æ–¥–∞—Ä–∫–∞–º–∏
    </p>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadProfile();
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ Telegram
    if (window.telegramWebApp) {
        window.telegramWebApp.MainButton.setText('–°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É');
        window.telegramWebApp.MainButton.onClick(() => {
            navigateTo('/create');
        });
        window.telegramWebApp.MainButton.show();
    }
});

function loadProfile() {
    if (window.telegramUser) {
        const user = window.telegramUser;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º UID
        document.getElementById('userName').textContent = user.first_name + (user.last_name ? ' ' + user.last_name : '');
        document.getElementById('userInfo').textContent = 'UID: –∑–∞–≥—Ä—É–∑–∫–∞...';
        
        console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', user.id);
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        loadUserStats(user.id);
    } else {
        console.error('telegramUser –Ω–µ –Ω–∞–π–¥–µ–Ω');
        document.getElementById('userInfo').textContent = '–û—à–∏–±–∫–∞: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö Telegram';
    }
}

function loadUserStats(userId) {
    console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userId);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–µ—Ä–≤–µ—Ä–∞
    fetch(`/api/user_profile?user_id=${userId}`)
        .then(response => {
            console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status);
            return response.json();
        })
        .then(data => {
            console.log('–î–∞–Ω–Ω—ã–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
            
            if (data.success) {
                const user = data.user;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ
                window.currentUserData = user;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UID –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
                if (user.uid) {
                    document.getElementById('userInfo').textContent = 'UID: ' + user.uid;
                    console.log('UID –æ–±–Ω–æ–≤–ª–µ–Ω:', user.uid);
                } else {
                    document.getElementById('userInfo').textContent = 'UID: –Ω–µ –Ω–∞–π–¥–µ–Ω';
                    console.error('UID –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å - –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
                const starsElement = document.querySelector('.card:nth-child(2) div:nth-child(2) div:nth-child(1) div:nth-child(1)');
                const rubElement = document.querySelector('.card:nth-child(2) div:nth-child(2) div:nth-child(2) div:nth-child(1)');
                
                if (starsElement) {
                    starsElement.textContent = `‚≠ê ${user.balance_stars}`;
                    console.log('–ë–∞–ª–∞–Ω—Å –∑–≤–µ–∑–¥ –æ–±–Ω–æ–≤–ª–µ–Ω:', user.balance_stars);
                }
                
                if (rubElement) {
                    rubElement.textContent = `‚ÇΩ ${user.balance_rub}`;
                    console.log('–ë–∞–ª–∞–Ω—Å —Ä—É–±–ª–µ–π –æ–±–Ω–æ–≤–ª–µ–Ω:', user.balance_rub);
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                if (document.getElementById('totalDeals')) {
                    document.getElementById('totalDeals').textContent = user.successful_deals;
                }
                if (document.getElementById('successfulDeals')) {
                    document.getElementById('successfulDeals').textContent = user.successful_deals;
                }
                
                console.log('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ');
            } else {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', data.message);
                document.getElementById('userInfo').textContent = '–û—à–∏–±–∫–∞: ' + data.message;
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            document.getElementById('userInfo').textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏';
        });
}

function updateAchievements(successfulDeals) {
    const achievements = document.querySelectorAll('.card:nth-child(3) > div > div');
    
    // –ü–µ—Ä–≤–∞—è —Å–¥–µ–ª–∫–∞
    if (successfulDeals >= 1) {
        achievements[0].style.opacity = '1';
    }
    
    // –û–ø—ã—Ç–Ω—ã–π —Ç—Ä–µ–π–¥–µ—Ä (10 —Å–¥–µ–ª–æ–∫)
    if (successfulDeals >= 10) {
        achievements[1].style.opacity = '1';
    }
    
    // VIP —Ç—Ä–µ–π–¥–µ—Ä (100 —Å–¥–µ–ª–æ–∫)
    if (successfulDeals >= 100) {
        achievements[2].style.opacity = '1';
    }
}

function showNotificationSettings() {
    showAlert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏');
}

function showSupport() {
    const supportMessage = `
üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞ NFT Gifts Market

üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã:
‚Ä¢ Telegram: @admin_username
‚Ä¢ Email: support@nftgifts.com

‚è∞ –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: 24/7
üìù –û–±—ã—á–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: 1-2 —á–∞—Å–∞

–û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è.
    `;
    
    showAlert(supportMessage);
}

function showAbout() {
    const aboutMessage = `
‚ÑπÔ∏è –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

NFT Gifts Market - —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ NFT –ø–æ–¥–∞—Ä–∫–∞–º–∏ –≤ Telegram.

üõ°Ô∏è –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
‚Ä¢ –°–∏—Å—Ç–µ–º–∞ —ç—Å–∫—Ä–æ—É –¥–ª—è –∑–∞—â–∏—Ç—ã —Å—Ä–µ–¥—Å—Ç–≤
‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ NFT
‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –≤–∞–ª—é—Ç
‚Ä¢ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

üì± –í–µ—Ä—Å–∏—è: 1.0
üè¢ –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: NFT Gifts Team
üìÖ –î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞: 2026

–°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è!
    `;
    
    showAlert(aboutMessage);
}
</script>
{% endblock %}